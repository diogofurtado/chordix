<!DOCTYPE html>
<html>
  <head>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <meta charset="utf-8">

    <link href="css/style.css" rel="stylesheet"/>
    <link href="css/foundation4.css" rel="stylesheet"/>

    <!--
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type='text/javascript' src='js/Tone.js'></script>
    <script type='text/javascript' src='js/chordcipher.js'></script>
    -->
    <script type='text/javascript' src='js/jquery-3.1.0.min.js'></script>
    <title>Hello World</title>
  </head>
  <body>
    <div class="cipher-container">
      <div class="row">
        <div class="large-12 columns textarea-container">
          <textarea class="textarea-input" placeholder="Cole aqui o cÃ³digo fonte"></textarea>
        </div>
        <div class="large-12 columns">
          <button id="textareaBt" class="fluid bt">ENVIAR</button>
        </div>
      </div>
    </div>
    <div class="row margin-bottom-20 margin-top-20">
      <div class="large-offset-2 large-8 columns cipher"></div>
    </div>
    <div class="row">
      <div class="large-offset-4 large-4 columns">
        <button id="playChord" class="fluid bt play-chord">Toque</button>
      </div>
    </div>
    <div class="row">
      <div class="large-offset-5 large-2 columns">
        <button id="playChord" class="fluid bt back-chord">Voltar</button>
      </div>
    </div>

    <script>
      var html = '';
      var parsedChords = '';
      var chords = []
      var container;
      var n = 0;

      $("#textareaBt").click(function(){
        html = $(".textarea-input").val();
        cifra = $(html).find('.cifra_cnt');
        $(".cipher").html(cifra);
        $(".cipher").show();
        $(".tablatura").remove();
        $(".play-chord").show();
        $(".back-chord").show();
        $(".cipher-container").hide();
        n = 0;

        $('html,body').animate({
          scrollTop:$('.cipher').offset().top
        }, 1000);

        html = $(html).find('script');

        $(html).filter(function(){
          var data = $(this);

          var re = /chords.*]/i;
          data.each(function(i, elem) {
            var content = $(this).text();
            var found = content.match(re);

            if (found != null) {
              var attr = found[0];

              var chords = attr.split('chords:')[1];
              parsedChords = JSON.parse(chords);

              //parsed JSON with the array of chords
              console.log(parsedChords);

              //list_chords = parsedChords;
              //mapChord(list_chords);
            }
          });
        });

        var j = 0;
        $("b").each(function(){
          for(i = 0; i < parsedChords.length; i++) {
            if ($(this)[0].firstChild.data == parsedChords[i].chord) {
              $(this).addClass("chord");
              $(this).attr('id', j);
              chords.push($(this));
              j++;
            }
          }
        })
      });

      var showChord = function(id) {
        container = $(".cipher");

        $(container).animate({
          scrollTop:$("#"+id).offset().top - container.offset().top + container.scrollTop()
        }, 280);

        $("#"+id).addClass('active');
      }

      var hideChord = function(id) {
        $("#"+id).removeClass('active');
      }

      $(".play-chord").click(function(){
        showChord(n);
        hideChord(n-1);
        n++;
      });

      $(".back-chord").click(function(){
        if(n > 1) {
          n--;
          hideChord(n);
          showChord(n-1);
        }
      });
    </script>
  </body>
</html>
